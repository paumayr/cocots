var at;(function(n){(function(n){(function(n){(function(n){var t=function(){function t(n){this.symSet=[],this.tab=n.tab,this.errors=n.errors,this.trace=n.trace,this.buffer=n.scanner.buffer,this.errorNr=-1,this.usingPos=null}return t.prototype.Indent=function(n){for(var t=1;t<=n;t++)this.gen.Write("\t")},t.prototype.Overlaps=function(n,t){for(var r=n.Count,i=0;i<r;++i)if(n[i]&&t[i])return!0;return!1},t.prototype.UseSwitch=function(t){var i,r,u;if(t.typ!=n.Node.alt)return!1;for(u=0,i=new n.BitArray(this.tab.terminals.length,!1);t!=null;){if((r=this.tab.Expected0(t.sub,this.curSy),this.Overlaps(i,r))||(i.Or(r),++u,t.sub.typ==n.Node.rslv))return!1;t=t.down}return u>5},t.prototype.CopySourcePart=function(n,i){var r,f,u;if(n!=null){for(this.buffer.Pos=n.beg,r=this.buffer.Read(),this.tab.emitLines&&(this.gen.WriteLine(),this.gen.WriteLineFormatted2('#line {0} "{1}"',n.line,this.tab.srcName)),this.Indent(i),u=!1;!u&&this.buffer.Pos<=n.end;){while(r==t.CR||r==t.LF){for(this.gen.WriteLine(),this.Indent(i),r==t.CR&&(r=this.buffer.Read()),r==t.LF&&(r=this.buffer.Read()),f=1;f<=n.col&&(r==" "||r=="\t");f++)r=this.buffer.Read();if(this.buffer.Pos>n.end){u=!0;break}}u||(this.gen.Write(r),r=this.buffer.Read())}i>0&&this.gen.WriteLine()}},t.prototype.GenErrorMsg=function(n,i){this.errorNr++,this.err.Write("\t\t\tcase "+this.errorNr+': s = "');switch(n){case t.tErr:i.name[0]=='"'?this.err.Write(this.tab.Escape(i.name)+" expected"):this.err.Write(i.name+" expected");break;case t.altErr:this.err.Write("invalid "+i.name);break;case t.syncErr:this.err.Write("this symbol not expected in "+i.name)}this.err.WriteLine('"; break;')},t.prototype.NewCondSet=function(t){for(var i=1;i<this.symSet.length;i++)if(n.Sets.Equals(t,this.symSet[i]))return i;return this.symSet.push(t.Clone()),this.symSet.length-1},t.prototype.GenCond=function(i,r){var u,f,e;if(r.typ==n.Node.rslv)this.CopySourcePart(r.pos,0);else if(u=n.Sets.Elements(i),u==0)this.gen.Write("false");else if(u<=t.maxTerm)for(f=0;f<this.tab.terminals.length;f++)e=this.tab.terminals[f],i[e.n]&&(this.gen.WriteFormatted1("this.la.kind == {0}",e.n),--u,u>0&&this.gen.Write(" || "));else this.gen.WriteFormatted1("this.StartOf({0})",this.NewCondSet(i))},t.prototype.PutCaseLabels=function(n){for(var i,t=0;t<this.tab.terminals.length;t++)i=this.tab.terminals[t],n[i.n]&&this.gen.WriteFormatted1("case {0}: ",i.n)},t.prototype.GenCode=function(i,r,u){for(var f,e,c,s,h,o;i!=null;){switch(i.typ){case n.Node.nt:this.Indent(r),this.gen.Write("var "),this.CopySourcePart(i.pos,0),this.gen.Write(" = "),this.gen.Write("this."+i.sym.name+"("),this.gen.WriteLineText(");");break;case n.Node.t:this.Indent(r),u[i.sym.n]?this.gen.WriteLineText("this.Get();"):this.gen.WriteLineFormatted1("this.Expect({0});",i.sym.n);break;case n.Node.wt:this.Indent(r),e=this.tab.Expected(i.next,this.curSy),e.Or(this.tab.allSyncSets),this.gen.WriteLineFormatted2("this.ExpectWeak({0}, {1});",i.sym.n,this.NewCondSet(e));break;case n.Node.any:this.Indent(r),s=n.Sets.Elements(i.set),this.tab.terminals.length==s+1||s>0&&n.Sets.Equals(i.set,u)?this.gen.WriteLineText("this.Get();"):(this.GenErrorMsg(t.altErr,this.curSy),s>0?(this.gen.Write("if ("),this.GenCond(i.set,i),this.gen.WriteLineFormatted1(") this.Get(); else this.SynErr({0});",this.errorNr)):this.gen.WriteLineFormatted1("this.SynErr({0}); // ANY node that matches no symbol",this.errorNr));break;case n.Node.sem:this.CopySourcePart(i.pos,r);break;case n.Node.sync:this.Indent(r),this.GenErrorMsg(t.syncErr,this.curSy),e=i.set.Clone(),this.gen.Write("while (!("),this.GenCond(e,i),this.gen.Write(")) {"),this.gen.WriteFormatted1("this.SynErr({0}); Get(); ",this.errorNr),this.gen.WriteLineText("}");break;case n.Node.alt:for(e=this.tab.First(i),h=n.Sets.Equals(e,u),o=this.UseSwitch(i),o&&(this.Indent(r),this.gen.WriteLineText("switch (this.la.kind) {")),f=i;f!=null;)e=this.tab.Expected(f.sub,this.curSy),this.Indent(r),o?(this.PutCaseLabels(e),this.gen.WriteLineText("{")):f==i?(this.gen.Write("if ("),this.GenCond(e,f.sub),this.gen.WriteLineText(") {")):f.down==null&&h?this.gen.WriteLineText("} else {"):(this.gen.Write("} else if ("),this.GenCond(e,f.sub),this.gen.WriteLineText(") {")),this.GenCode(f.sub,r+1,e),o&&(this.Indent(r),this.gen.WriteLineText("\tbreak;"),this.Indent(r),this.gen.WriteLineText("}")),f=f.down;this.Indent(r),h?this.gen.WriteLineText("}"):(this.GenErrorMsg(t.altErr,this.curSy),o?(this.gen.WriteLineFormatted1("default: this.SynErr({0}); break;",this.errorNr),this.Indent(r),this.gen.WriteLineText("}")):(this.gen.Write("} "),this.gen.WriteLineFormatted1("else this.SynErr({0});",this.errorNr)));break;case n.Node.iter:this.Indent(r),f=i.sub,this.gen.Write("while ("),f.typ==n.Node.wt?(e=this.tab.Expected(f.next,this.curSy),c=this.tab.Expected(i.next,this.curSy),this.gen.WriteFormatted3("this.WeakSeparator({0},{1},{2}) ",f.sym.n,this.NewCondSet(e),this.NewCondSet(c)),e=new n.BitArray(this.tab.terminals.length,!1),f=f.up||f.next==null?null:f.next):(e=this.tab.First(f),this.GenCond(e,f)),this.gen.WriteLineText(") {"),this.GenCode(f,r+1,e),this.Indent(r),this.gen.WriteLineText("}");break;case n.Node.opt:e=this.tab.First(i.sub),this.Indent(r),this.gen.Write("if ("),this.GenCond(e,i.sub),this.gen.WriteLineText(") {"),this.GenCode(i.sub,r+1,e),this.Indent(r),this.gen.WriteLineText("}")}if(i.typ!=n.Node.eps&&i.typ!=n.Node.sem&&i.typ!=n.Node.sync&&u.SetAll(!1),i.up)break;i=i.next}},t.prototype.GenTokens=function(){for(var i,t=0;t<this.tab.terminals.length;t++)i=this.tab.terminals[t],n.isLetter(i.name[0])&&this.gen.WriteLineFormatted2("\tpublic static _{0} : number = {1};",i.name,i.n)},t.prototype.GenPragmas=function(){for(var t,n=0;n<this.tab.pragmas.length;n++)t=this.tab.pragmas[n],this.gen.WriteLineFormatted2("\tpublic static _{0} : number = {1};",t.name,t.n)},t.prototype.GenCodePragmas=function(){for(var t,n=0;n<this.tab.pragmas.length;n++)t=this.tab.pragmas[n],this.gen.WriteLineFormatted1("\t\t\t\tif (this.la.kind == {0}) {{",t.n),this.CopySourcePart(t.semPos,4),this.gen.WriteLineText("\t\t\t\t}")},t.prototype.GenProductions=function(){for(var t,i=0;i<this.tab.nonterminals.length;i++)t=this.tab.nonterminals[i],this.curSy=t,t.attrPos!=null&&t.attrPos.end-t.attrPos.beg>0?(this.gen.WriteFormatted1("\t{0}(ret : {{",t.name),this.CopySourcePart(t.attrPos,0),this.gen.WriteLineText("}) {")):this.gen.WriteFormatted1("\t{0}() {{",t.name),this.CopySourcePart(t.semPos,2),this.GenCode(t.graph,2,new n.BitArray(this.tab.terminals.length,!1)),this.gen.WriteLineText("\t}")},t.prototype.InitSets=function(){for(var i,t,r,n=0;n<this.symSet.length;n++){for(i=this.symSet[n],this.gen.Write("\t\t["),t=0;t<this.tab.terminals.length;t++)r=this.tab.terminals[t],i[r.n]?this.gen.Write("true,"):this.gen.Write("false,"),t%4==0&&this.gen.Write(" ");n==this.symSet.length-1?this.gen.WriteLineText("false]"):this.gen.WriteLineText("false],")}},t.prototype.WriteParser=function(){var i=new n.Generator(this.tab),f=this.buffer.Pos,r,u;for(this.symSet.push(this.tab.allSyncSets),this.fram=i.OpenFrame("Parser.frame"),this.gen=i.OpenGen("Parser.ts"),this.err=new n.StringWriter,r=0;r<this.tab.terminals.length;r++)u=this.tab.terminals[r],this.GenErrorMsg(t.tErr,u);i.GenCopyright(),i.SkipFramePart("-->begin"),this.usingPos!=null&&(this.CopySourcePart(this.usingPos,0),this.gen.WriteLine()),i.CopyFramePart("-->namespace"),this.tab.nsName!=null&&this.tab.nsName.length>0&&(this.gen.WriteLineFormatted1("module {0} {{",this.tab.nsName),this.gen.WriteLine()),i.CopyFramePart("-->constants"),this.GenTokens(),this.gen.WriteLineFormatted1("\tpublic static maxT : number = {0};",this.tab.terminals.length-1),this.GenPragmas(),i.CopyFramePart("-->declarations"),this.CopySourcePart(this.tab.semDeclPos,0),i.CopyFramePart("-->pragmas"),this.GenCodePragmas(),i.CopyFramePart("-->productions"),this.GenProductions(),i.CopyFramePart("-->parseRoot"),this.gen.WriteLineFormatted1("\t\tthis.{0}();",this.tab.gramSy.name),this.tab.checkEOF&&this.gen.WriteLineText("\t\tthis.Expect(0);"),i.CopyFramePart("-->initialization"),this.InitSets(),i.CopyFramePart("-->errors"),this.gen.Write(this.err.ToString()),i.CopyFramePart(null),this.tab.nsName!=null&&this.tab.nsName.length>0&&this.gen.Write("}"),this.gen.Close(),this.buffer.Pos=f},t.prototype.WriteStatistics=function(){this.trace.WriteLine(),this.trace.WriteLineFormatted1("{0} terminals",this.tab.terminals.length),this.trace.WriteLineFormatted1("{0} symbols",this.tab.terminals.length+this.tab.pragmas.length+this.tab.nonterminals.length),this.trace.WriteLineFormatted1("{0} nodes",this.tab.nodes.length),this.trace.WriteLineFormatted1("{0} sets",this.symSet.length)},t.maxTerm=3,t.CR="\r",t.LF="\n",t.EOF=-1,t.tErr=0,t.altErr=1,t.syncErr=2,t}();n.ParserGen=t})(n.coco||(n.coco={}));var t=n.coco})(n.ssw||(n.ssw={}));var t=n.ssw})(n.jku||(n.jku={}));var t=n.jku})(at||(at={}))